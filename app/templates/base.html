<!DOCTYPE html>
<html>
<head>
    <title>家庭服务器</title>
    <meta charset="UTF-8">
    <!-- Bootstrap 5 依赖 -->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <script src="{{ url_for('static', filename='js/libs/jquery-3.6.0.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/libs/bootstrap.bundle.min.js') }}"></script>
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-icons.css') }}">
    {% block resource %}{% endblock %}
   <style>
/* 固定布局样式 */
body {
    overflow: hidden; /* 禁用全局滚动条 */
    padding-top: 60px; /* 为顶部导航栏预留空间 */
}

.header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 60px;
    z-index: 100;
    background: #2c3e50;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.main-container {
    position: fixed;
    top: 60px;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
}

.layout-container {
    display: flex;
    width: 100%;
    height: 100%;
}

/* 左侧菜单样式 */
.sidebar {
    width: 250px;
    height: 100%;
    background: #ffffff;
    border-right: 1px solid #dee2e6;
    overflow-y: auto; /* 菜单过长时自身滚动 */
    position: fixed;
    left: 0;
    bottom: 0;
}

.nav-menu {
    padding: 1rem 0;
}

.nav-link {
    padding: 0.75rem 1.5rem;
    color: #495057;
    transition: all 0.2s;
    border-left: 4px solid transparent;
}

.nav-link:hover {
    background: #f8f9fa;
    color: #2c3e50;
}

.nav-link.active {
    background: #f8f9fa;
    border-left-color: #2c3e50;
    color: #2c3e50;
    font-weight: 500;
}

/* 内容区域样式 */
.content-area {
    flex: 1;
    margin-left: 250px; /* 等于侧边栏宽度 */
    height: calc(100vh - 60px); /* 计算剩余高度 */
    overflow-y: auto; /* 启用滚动 */
    padding: 1rem;
    background: #f8f9fa;
}

/* 可拖拽分隔条样式 */
.resizer {
    width: 5px;
    background: #dee2e6;
    cursor: col-resize;
    position: fixed;
    left: 250px;
    top: 60px;
    bottom: 0;
    z-index: 100;
}

/* 用户下拉菜单优化 */
.dropdown-menu {
    box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.1);
    border: 1px solid rgba(0,0,0,0.1);
}
</style>

</head>
<body>
    <!-- 顶部导航栏 -->
    <nav class="navbar navbar-dark header">
        <div class="container-fluid">
            <span class="navbar-brand">家庭服务器</span>

            <!-- 用户操作区 -->
            <div class="dropdown">
                <button class="btn btn-link text-white dropdown-toggle d-flex align-items-center"
                        type="button"
                        data-bs-toggle="dropdown">
                    <i class="bi bi-person-circle me-2"></i>
                    {{session.user.username}}
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item" href="/author/me">
                        <i class="bi bi-person me-2"></i>个人中心
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item text-danger" href="/author/logout">
                        <i class="bi bi-box-arrow-right me-2"></i>退出登录
                    </a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 主体容器 -->
    <div class="main-container">
        <div class="layout-container">
            <!-- 左侧菜单 -->
            <div class="sidebar">
                <nav class="nav flex-column nav-menu">
                    <a class="nav-link active" href="#">
                        <i class="bi bi-house-door me-2"></i>首页
                    </a>
                    <a class="nav-link" href="/files">
                        <i class="bi bi-folder me-2"></i>文件
                    </a>
                    <a class="nav-link" href="/experiences">
                        <i class="bi bi-lightbulb me-2"></i>经验
                    </a>
                    <a class="nav-link" href="/memos">
                        <i class="bi bi-journal-check me-2"></i>备忘录
                    </a>
                    <a class="nav-link" href="/favorites">
                        <i class="bi bi-stars me-2"></i>收藏
                    </a>
                    <a class="nav-link" href="/tools">
                        <i class="bi bi-tools me-2"></i>工具
                    </a>
                    <a class="nav-link" href="/author/users">
                        <i class="bi bi-people me-2"></i>用户管理
                    </a>
                    <a class="nav-link"href="/settings">
                        <i class="bi bi-gear me-2"></i>系统设置
                    </a>
                </nav>
            </div>

            <!-- 可拖拽分隔条 -->
            <div class="resizer"></div>

            <!-- 内容区域 -->
            <div class="content-area" id="mainContent">
                {% include content_frame | default('components/default_frame.html') %}
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/custom-dialog.js') }}"></script>
    <script>

        let isDragging = false;

        // 侧边栏拖拽调整宽度
        const resizer = document.querySelector('.resizer');
        const sidebar = document.querySelector('.sidebar');
        const content = document.querySelector('.content-area');

        resizer.addEventListener('mousedown', initResize);

        function initResize(e) {
            window.addEventListener('mousemove', resize);
            window.addEventListener('mouseup', stopResize);
        }

        function resize(e) {
            const newWidth = e.clientX;
            if(newWidth > 200 && newWidth < 400) {
                sidebar.style.width = newWidth + 'px';
                content.style.marginLeft = newWidth + 'px';
                resizer.style.left = newWidth + 'px';
            }
            isDragging = true;
        }

        function stopResize() {
            window.removeEventListener('mousemove', resize);
            window.removeEventListener('mouseup', stopResize);
            isDragging = false;
        }

        // 防止文本选中
        document.onselectstart = function(e) {
            if (isDragging) return false;
        };
    </script>
    {% block javascript %}  {% endblock %}
    {% include 'components/modal_frame.html' %}

</body>
</html>
