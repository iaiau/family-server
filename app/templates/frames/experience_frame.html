<!-- Font Awesome -->
{% block resource %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/all.min.css') }}">
<style>
    .timeline-node {
        position: relative;
        padding-left: 30px;
        margin-bottom: 30px;
    }
    .timeline-node::before {
        content: "";
        position: absolute;
        left: 0;
        top: 5px;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: #0d6efd;
    }
    .experience-card {
        transition: transform 0.3s;
        border-left: 3px solid transparent;
    }
    .experience-card:hover {
        transform: translateX(10px);
        border-color: #0d6efd;
    }
    .tag-cloud {
        line-height: 2rem;
    }
    .tag-item {
        transition: all 0.3s;
        cursor: pointer;
    }
    .tag-item:hover {
        background: #e3f2fd!important;
    }
</style>
{% endblock %}
<!-- 导航栏 -->
<nav class="navbar navbar-expand-lg bg-light shadow-sm">
    <div class="container">
        <a class="navbar-brand" href="#">
            <i class="fa-solid fa-lightbulb me-2"></i>技术洞见库
        </a>
        <button class="btn btn-primary" id="newExperience">
            <i class="fa-solid fa-plus me-2"></i>分享经验
        </button>
    </div>
</nav>

<div class="container py-4">
    <div class="row">
        <!-- 侧边栏 -->
        <div class="col-lg-3 mb-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="mb-3">知识图谱</h5>
                    <div class="tag-cloud">
                        <span class="tag-item badge bg-light text-dark me-2 mb-2">架构设计</span>
                        <span class="tag-item badge bg-light text-dark me-2 mb-2">性能优化</span>
                        <span class="tag-item badge bg-light text-dark me-2 mb-2">故障排查</span>
                    </div>
                    <hr>
                    <div class="timeline-node">
                        <h6>2023里程碑</h6>
                        <div class="text-muted small">累计分享32篇</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主内容 -->
        <div class="col-lg-9">
            <div class="row g-4" id="experienceContainer">
                <!-- 经验卡片动态加载 -->
            </div>
        </div>
    </div>
</div>

{% block javascript %}
<script>
    // 数据结构
    let experiences = JSON.parse(localStorage.getItem('experiences')) || [];

    // 渲染经验卡片
    function renderExperiences() {
        $('#experienceContainer').empty();
        experiences.forEach(exp => {
            const card = `
                <div class="col-md-6">
                    <div class="card experience-card h-100 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between mb-3">
                                <span class="badge bg-primary">${exp.category}</span>
                                <small class="text-muted">${new Date(exp.date).toLocaleDateString()}</small>
                            </div>
                            <h5 class="card-title">${exp.title}</h5>
                            <p class="card-text text-muted">${exp.methodology}</p>
                            <div class="bg-light p-3 mb-3 rounded">
                                ${exp.validation}
                            </div>
                            <button class="btn btn-outline-primary btn-sm">
                                <i class="fa-solid fa-heart"></i> 126
                            </button>
                        </div>
                    </div>
                </div>`;
            $('#experienceContainer').append(card);
        });
    }

    // 新建经验
    $('#newExperience').click(() => {
        //$('#editModal').modal('show');
        //$('#experienceForm').reset();
        //$('#validationEditor').html('');
        window.location.href = "/experiences/new_exp";
    });

    // 保存经验
    $('#saveExperience').click(() => {
        const newExp = {
            id: Date.now(),
            title: $('#expTitle').val(),
            methodology: $('#methodology').val(),
            validation: $('#validationEditor').html(),
            category: $('#category').val(),
            difficulty: $('input[name="difficulty"]:checked').attr('id'),
            date: new Date()
        };

        experiences.push(newExp);
        localStorage.setItem('experiences', JSON.stringify(experiences));
        $('#editModal').modal('hide');
        renderExperiences();
    });

    // 初始化渲染
    renderExperiences();
</script>
{% endblock %}
